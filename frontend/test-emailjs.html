<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test EmailJS - ASOPROMAS</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #ea580c;
            margin-bottom: 30px;
        }
        .config-info {
            background: #fef3c7;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .config-info h3 {
            margin-top: 0;
            color: #92400e;
        }
        .config-item {
            margin: 10px 0;
            font-family: monospace;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .status.success {
            background: #d1fae5;
            color: #065f46;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }
        .status.info {
            background: #dbeafe;
            color: #1e40af;
        }
        button {
            background: linear-gradient(135deg, #f59e0b 0%, #ea580c 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            opacity: 0.9;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .template-test {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        input[type="email"], input[type="text"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
        }
        label {
            font-weight: bold;
            color: #374151;
            display: block;
            margin-top: 15px;
        }
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid #f3f4f6;
            border-radius: 50%;
            border-top-color: #ea580c;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test de EmailJS - ASOPROMAS</h1>
        
        <div class="config-info">
            <h3>üìã Configuraci√≥n Actual:</h3>
            <div class="config-item"><strong>Service ID:</strong> service_rc3f9e7</div>
            <div class="config-item"><strong>Template ID (Cliente):</strong> template_3vc5pdh</div>
            <div class="config-item"><strong>Public Key:</strong> dOXxZUCQTP-kLZr92</div>
        </div>

        <div id="statusDiv" class="status info">
            ‚è≥ Inicializando EmailJS...
        </div>

        <div class="template-test">
            <h3>üìß Probar Env√≠o de Email al Cliente</h3>
            
            <label>Email del Cliente:</label>
            <input type="email" id="customerEmail" placeholder="cliente@ejemplo.com" value="luislituma22@gmail.com">
            
            <label>Nombre del Cliente:</label>
            <input type="text" id="customerName" placeholder="Juan P√©rez" value="Luis Lituma">
            
            <button id="testBtn" onclick="testEmail()">
                Enviar Email de Prueba
            </button>
        </div>

        <div id="resultDiv"></div>
    </div>

    <script>
        // Configuraci√≥n
        const CONFIG = {
            SERVICE_ID: 'service_rc3f9e7',
            TEMPLATE_ID: 'template_3vc5pdh',
            PUBLIC_KEY: 'dOXxZUCQTP-kLZr92'
        };

        // Inicializar EmailJS
        (function() {
            try {
                emailjs.init(CONFIG.PUBLIC_KEY);
                showStatus('‚úÖ EmailJS inicializado correctamente', 'success');
                console.log('‚úÖ EmailJS inicializado');
            } catch (error) {
                showStatus('‚ùå Error al inicializar EmailJS: ' + error.message, 'error');
                console.error('Error:', error);
            }
        })();

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusDiv');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
        }

        function showResult(message, type) {
            const resultDiv = document.getElementById('resultDiv');
            const div = document.createElement('div');
            div.className = 'status ' + type;
            div.textContent = message;
            resultDiv.appendChild(div);
        }

        async function testEmail() {
            const btn = document.getElementById('testBtn');
            const customerEmail = document.getElementById('customerEmail').value;
            const customerName = document.getElementById('customerName').value;

            if (!customerEmail || !customerName) {
                showResult('‚ö†Ô∏è Por favor completa todos los campos', 'error');
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Enviando...';
            
            showStatus('üì§ Enviando email de prueba...', 'info');

            try {
                // Datos de prueba del pedido
                const orderNumber = `ASOP-TEST-${Date.now().toString().slice(-6)}`;
                const orderDate = new Date().toLocaleString('es-EC', {
                    dateStyle: 'full',
                    timeStyle: 'short'
                });

                const templateParams = {
                    to_email: customerEmail,
                    to_name: customerName,
                    order_number: orderNumber,
                    order_date: orderDate,
                    products_list: `1. Chocolate Negro 70% Cacao\n   Cantidad: 2 x $3.50 = $7.00\n\n2. Licor de Cacao Premium\n   Cantidad: 1 x $12.00 = $12.00`,
                    subtotal: '$19.00',
                    iva: '$2.28',
                    total: '$21.28',
                    company_email: 'luislituma22@gmail.com'
                };

                console.log('üìß Enviando con par√°metros:', templateParams);

                const response = await emailjs.send(
                    CONFIG.SERVICE_ID,
                    CONFIG.TEMPLATE_ID,
                    templateParams,
                    CONFIG.PUBLIC_KEY
                );

                console.log('‚úÖ Respuesta:', response);
                showStatus('‚úÖ Email enviado exitosamente!', 'success');
                showResult(`‚úÖ Email enviado a: ${customerEmail}\nPedido: ${orderNumber}\nStatus: ${response.status} - ${response.text}`, 'success');

            } catch (error) {
                console.error('‚ùå Error completo:', error);
                showStatus('‚ùå Error al enviar email', 'error');
                showResult(`‚ùå Error: ${error.text || error.message}\n\nPosibles causas:\n‚Ä¢ Plantilla no existe o nombre incorrecto\n‚Ä¢ Campos de plantilla no coinciden\n‚Ä¢ Service ID o Public Key incorrectos\n‚Ä¢ L√≠mite de emails alcanzado\n‚Ä¢ Email bloqueado por EmailJS`, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Enviar Email de Prueba';
            }
        }

        // Verificar configuraci√≥n al cargar
        window.onload = function() {
            console.log('üîç Verificando configuraci√≥n...');
            console.log('Service ID:', CONFIG.SERVICE_ID);
            console.log('Template ID:', CONFIG.TEMPLATE_ID);
            console.log('Public Key:', CONFIG.PUBLIC_KEY.substring(0, 5) + '...');
            
            showResult(`üìã Instrucciones:
1. Verifica que tu plantilla en EmailJS tenga el ID: ${CONFIG.TEMPLATE_ID}
2. Aseg√∫rate que la plantilla tenga estos campos:
   - to_email, to_name, order_number, order_date
   - products_list, subtotal, iva, total, company_email
3. Haz clic en "Enviar Email de Prueba"
4. Revisa tu bandeja de entrada (y spam)`, 'info');
        };
    </script>
</body>
</html>
